<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telemetria K.D.E.T</title>
    <style>
        body{
            align-items: center;
            background-color: rgb(126, 138, 162);
        }
        div.page-home{
            border-radius: 15px;
            text-align: center;
            align-items: center;
            margin: 0 15%;
            background-color: rgb(255, 152, 0);
            padding: 5%;
        }
        section{
            margin: 15px;
            padding: 10px;
            font-family: Arial, Helvetica, sans-serif;
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
        }
        input{
            background-color: rgb(38, 50, 72);
            color: rgb(255, 255, 255);
            font-weight: bold;
            width: 130px;
            border-radius: 15px;
        }
    </style>
</head>
<body onload="lerDados()">
    <div class="page-home">
        <section>
            <h1>Leitura da informação</h1>
            <p id="reserv">Status do reservatório: 0%</p>
            <p id="tanque">Status do tanque: 0%</p>
        </section>
        <section>
            <h1>Controle da bomba</h1>
            <form action="">
                <input type="submit" value="Ligar" name="on">
                <input type="submit" value="Desligar" name="off">
            </form>
        </section>
    </div>
    <script>
        function lerDados(){
            const request = new XMLHttpRequest();

            request.onreadystatechange = function() {
                if(this.readyState == 4 && this.status == 200){
                    let resp = JSON.parse(this.responseText);
                    const reserv = document.querySelector("p#reserv");
                    const tanque = document.querySelector("p#tanque");
                    console.log(resp);
                    let ReservStatus = "Aguardando sinal...";
                    let TanqueStatus = "Aguardando sinal...";
                    
                    if (resp.reservA==1&&resp.reservB==1) {
                        ReservStatus = "Cheio!";
                    }
                    if (resp.reservA==0&&resp.reservB==1){
                        ReservStatus = "Baixo!";
                    }
                    if(resp.reservA==0&&resp.reservB==0){
                        ReservStatus = "Vazio!";
                    }
                    if(resp.tanqueA==1&&resp.tanqueB==1){
                        TanqueStatus = "Cheio!";
                    }
                    if(resp.tanqueA==0&&resp.tanqueB==1){
                        TanqueStatus = "Baixo!";
                    }
                    if(resp.tanqueA==0&&resp.tanqueB==0){
                        TanqueStatus = "Vazio";
                    }
                    reserv.innerText = `Status do reservatório: ${ReservStatus}` ;
                    tanque.innerText = `Status do tanque: ${TanqueStatus}`;
                }
            
            };

            request.open("GET", "dados", true);
            request.send(null);
            setTimeout("lerDados()", 500);
        }
    </script>
</body>
</html>